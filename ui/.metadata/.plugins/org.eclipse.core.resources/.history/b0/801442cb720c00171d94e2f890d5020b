<%@page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<%@include file="header.jsp"%>
<style type="text/css">

</style>
</head>
<body>
	<fieldset class="main_fieldset_r">
		<legend>
			<img class="head_img" src="/img/list_banner.svg">
			<span></span> of History
		</legend>
		
		<table id="history_list_table" class="tablesorter_r">
			<thead>
				<tr>
					<th width="20px;"></th>
					<th>timestamp</th>
					<th>configs</th>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
	</fieldset>
</body>

<script type="text/javascript">
var profile_id = '<%= HttpGet.get(request, "profile_id", "")%>';

var history_list_table_xlat = {
		tag: "tr",
		id: "$\{id\}",
		class:"pointer",
		children: [
			{tag:"td", html:"$\{timestamp\}"},
			{tag:"td", html:"$\{profile.configListNames\}"},
		]
};

function load_history_list() {
	jQuery.ajax({
		url: "/get_history.jsp",
		data: {profile_id: profile_id},
		cache: false,
		beforeSend: function() {
			$("#history_list_table > tbody").empty();
		},
		dataType: "json",
		success: function(result) {
			if (result.good == false) {
				pop("Error loading for history list: "+result.cause);
				return;
			}			
			$("#history_list_table > tbody").html(
				json2html.transform(result, history_list_table_xlat)
			);
			$("#history_list_table").tablesorter({
				headers: {
					0: {sorter: false},
					2: {sorter: false},
				}
			}).trigger("update");
			/*
			$("#profile_list_table > tbody > tr").click(function(e) {
				$("#profile_list_table > tbody > tr").removeClass('selected');				
				$(this).toggleClass('selected');
				$(".profile_check_img").addClass('hidden');
				$("#img_"+$(this).attr("id")).toggleClass('hidden');
			});
			
			$("#profile_list_table > tbody > tr").dblclick(function(e) {
				$("#modify_profile").trigger("click");
			});
			
			bind_delete_profile();
			*/
			
			load_ok();
		},
		error: function(e) {
			load_ok();
			//ajax_err_handle(e);
			pop("Error loading for history.\nplease retry...");
		}
	});
}

function bind_delete_profile() {
	$(".profile_del_img").click(function() {
		if (!confirm("Are you sure delete profile ?")) {
			return;
		}
		var profileId = $(this).attr("id");
		jQuery.ajax({
			url: "/del_profile.jsp",
			data: { 'profile_id': profileId },
			cache: false,
			dataType: "json",
			success: function(result) {
				if (result.good == false) {
					pop("Error loading for profile.\n"+result.cause);
					return;
				}
				pop("success delete profile");
				load_profile_list();
			},
			error: function(e) {
				//ajax_err_handle(e);
				pop("Error delete profile.\nplease retry...");
			}
		});
	});
}

$(document).ready(function() {
	load_history_list();
});
</script>
<%@include file="footer.jsp"%>
</html>
